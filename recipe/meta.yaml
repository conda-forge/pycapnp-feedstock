{% set name = "pycapnp" %}
{% set version = "2.0.0" %}


package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://pypi.io/packages/source/{{ name[0] }}/{{ name }}/pycapnp-{{ version }}.tar.gz
  sha256: 503ab9b7b16773590ee226f2460408972c6b1c2cb2d819037115b919bef682be

build:
  skip: true  # [python_impl == 'pypy']
  number: 0
  script:
    - copy /y "{{ LIBRARY_INC }}\capnp\*.capnp" .\capnp\  # [win]
    - cp -f {{ PREFIX }}/include/capnp/*.capnp ./capnp/  # [not win]
    - {{ PYTHON }} setup.py install --single-version-externally-managed --record=record.txt --force-system-libcapnp  # [win]
    - {{ PYTHON }} setup.py install --single-version-externally-managed --record=record.txt  # [not win]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
  host:
    - capnproto
    # <3 because https://github.com/capnproto/pycapnp/issues/319
    - cython <3
    - libxcrypt  # [py==38 and linux]
    - pkgconfig
    - setuptools
    - python
  run:
    - python
    - __osx >={{ MACOSX_DEPLOYMENT_TARGET|default("10.9") }}  # [osx and x86_64]

test:
  source_files:
    - test
    - examples
  requires:
    - python
    - pytest
  imports:
    - capnp
  commands:
    - pytest test

about:
  home: https://github.com/capnproto/pycapnp
  summary: A cython wrapping of the C++ Cap'n Proto library
  license: BSD-2-Clause
  license_file: LICENSE.md

extra:
  recipe-maintainers:
    - LehMaxence
